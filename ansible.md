# Задание 3: Создание роли Apache

## Плейбук site.yml

Главный плейбук, который использует созданную роль:

```yaml
---
- name: Deploy Apache Web Server
  hosts: all
  become: yes
  gather_facts: yes

  roles:
    - apache_webserver
```

## Структура роли apache_webserver

```
roles/apache_webserver/
├── tasks/main.yml
├── handlers/main.yml
└── templates/index.html.j2
```

### tasks/main.yml

```yaml
---
- name: Install Apache (RedHat)
  ansible.builtin.dnf:
    name: httpd
    state: present
  when: ansible_os_family == "RedHat"
  notify: Restart Apache

- name: Install Apache (Debian)
  ansible.builtin.apt:
    name: apache2
    state: present
    update_cache: yes
  when: ansible_os_family == "Debian"
  notify: Restart Apache

- name: Open port 80 (firewalld)
  ansible.posix.firewalld:
    port: 80/tcp
    permanent: yes
    state: enabled
    immediate: yes
  when: ansible_os_family == "RedHat"
  ignore_errors: yes

- name: Deploy index.html
  ansible.builtin.template:
    src: index.html.j2
    dest: /var/www/html/index.html
  notify: Restart Apache

- name: Start Apache
  ansible.builtin.systemd:
    name: "{{ 'httpd' if ansible_os_family == 'RedHat' else 'apache2' }}"
    state: started
    enabled: yes

- name: Check website (HTTP 200)
  ansible.builtin.uri:
    url: "http://{{ ansible_default_ipv4.address }}/"
    status_code: 200
```

### handlers/main.yml

```yaml
---
- name: Restart Apache
  ansible.builtin.systemd:
    name: "{{ 'httpd' if ansible_os_family == 'RedHat' else 'apache2' }}"
    state: restarted
```

### templates/index.html.j2

```html
<!DOCTYPE html>
<html>
<head>
    <title>Server Info - {{ ansible_hostname }}</title>
    <style>
        body { font-family: Arial; margin: 40px; background: #f0f0f0; }
        .container { background: white; padding: 30px; border-radius: 10px; max-width: 600px; }
        h1 { color: #333; }
        table { width: 100%; border-collapse: collapse; }
        td { padding: 10px; border-bottom: 1px solid #ddd; }
        .label { font-weight: bold; width: 40%; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Информация о сервере</h1>
        <table>
            <tr><td class="label">Hostname:</td><td>{{ ansible_hostname }}</td></tr>
            <tr><td class="label">IP-адрес:</td><td>{{ ansible_default_ipv4.address }}</td></tr>
            <tr><td class="label">CPU:</td><td>{{ ansible_processor[2] }} ({{ ansible_processor_cores }} cores)</td></tr>
            <tr><td class="label">RAM:</td><td>{{ (ansible_memtotal_mb / 1024) | round(2) }} GB</td></tr>
            <tr><td class="label">HDD:</td><td>{% for dev, info in ansible_devices.items() %}{% if dev.startswith('sd') or dev.startswith('vd') %}{{ dev }}: {{ info.size }}{% endif %}{% endfor %}</td></tr>
        </table>
        <p><small>Generated by Ansible</small></p>
    </div>
</body>
</html>
```

## Ссылка на архив роли

[apache_webserver_role.tar.gz на Google Drive](https://drive.google.com/file/d/1MAOr108rQ1niW0VIHDj15QUWAkyKHHm9/view?usp=sharing)

## Результат выполнения плейбука

Запуск: `ansible-playbook -i inventory.ini site.yml`

```
PLAY [Deploy Apache Web Server] **************************************************

TASK [Gathering Facts] ***********************************************************
ok: [localhost]

TASK [apache_webserver : Install Apache (RedHat)] ********************************
skipping: [localhost]

TASK [apache_webserver : Install Apache (Debian)] ********************************
changed: [localhost]

TASK [apache_webserver : Open port 80 (firewalld)] *******************************
skipping: [localhost]

TASK [apache_webserver : Deploy index.html] **************************************
changed: [localhost]

TASK [apache_webserver : Start Apache] *******************************************
ok: [localhost]

TASK [apache_webserver : Check website (HTTP 200)] *******************************
ok: [localhost]

RUNNING HANDLER [apache_webserver : Restart Apache] ******************************
changed: [localhost]

PLAY RECAP ***********************************************************************
localhost                  : ok=6    changed=3    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0
```

Плейбук успешно выполнил все задачи:
- Установил Apache (apache2 для Ubuntu)
- Развернул index.html из Jinja2-шаблона с информацией о системе
- Запустил сервер и добавил его в автозагрузку
- Проверил доступность сайта (HTTP 200)
- Handler перезапустил Apache после изменения конфигурации

## Скриншот веб-страницы

Страница доступна по адресу http://localhost и отображает:

- **Hostname:** nikolay-VMware-Virtual-Platform
- **IP-адрес:** 192.168.195.132
- **CPU:** 12th Gen Intel(R) Core(TM) i7-12700K (1 cores)
- **RAM:** 3.78 GB
- **HDD:** sda: 40.00 GB
